# Security Fixes - CZ Vertical Menu v1.0.6

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (Critical)

#### 1. SQL Injection –≤ `hookActionShopDataDuplication()`

**–§–∞–π–ª:** `cz_verticalmenu.php`, —Å—Ç—Ä–æ–∫–∞ 1129

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```php
VALUES ('.(int)$link['new_id_czverticalmenu'].', '.(int)$l['id_lang'].',
        '.(int)$params['new_id_shop'].', '.(int)$l['label'].', '.(int)$l['link'].' )');
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–æ–ª—è `$l['label']` –∏ `$l['link']` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å —Ñ—É–Ω–∫—Ü–∏–µ–π `(int)`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```php
VALUES ('.(int)$link['new_id_czverticalmenu'].', '.(int)$l['id_lang'].',
        '.(int)$params['new_id_shop'].', "'.pSQL($l['label']).'", "'.pSQL($l['link']).'" )');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `pSQL()` –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

**–£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** CRITICAL (CVSS 9.1)

---

### üü† –í—ã—Å–æ–∫–∏–µ (High)

#### 2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `getContent()`

**–§–∞–π–ª:** `cz_verticalmenu.php`, —Å—Ç—Ä–æ–∫–∏ 259, 264

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```php
$id_czverticalmenu = Tools::getValue('id_czverticalmenu', 0);
Configuration::updateValue('MOD_CZVERTICALMENU_ITEMS',
    str_replace(array('LNK'.$id_czverticalmenu.',', 'LNK'.$id_czverticalmenu), '', ...));
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Ü–µ–ª–æ–º—É —á–∏—Å–ª—É –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```php
$id_czverticalmenu = (int)Tools::getValue('id_czverticalmenu', 0);
Configuration::updateValue('MOD_CZVERTICALMENU_ITEMS',
    str_replace(array('LNK'.(int)$id_czverticalmenu.',', 'LNK'.(int)$id_czverticalmenu), '', ...));
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** HIGH (CVSS 7.5)

---

#### 3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–§–∞–π–ª:** `cz_verticalmenu.php`, —Å—Ç—Ä–æ–∫–∏ 202, 241

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```php
$number_cols = Tools::getValue('number_cols_menu');
$added = Cz_VerticalMenuTopLinks::add($links_label, $labels, Tools::getValue('new_window', 0), ...);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —è–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ—á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```php
$number_cols = (int)Tools::getValue('number_cols_menu');
$added = Cz_VerticalMenuTopLinks::add($links_label, $labels, (int)Tools::getValue('new_window', 0), ...);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ó–∞—â–∏—Ç–∞ –æ—Ç type juggling –∞—Ç–∞–∫

**–£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** HIGH (CVSS 6.8)

---

## –°–≤–æ–¥–∫–∞ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ù–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- ‚úÖ 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è SQL-–∏–Ω—ä–µ–∫—Ü–∏—è
- ‚úÖ 3 –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—â–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è

### –£–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞—â–∏—Ç–∞:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `pSQL()` –≤ –º–µ—Ç–æ–¥–∞—Ö –∫–ª–∞—Å—Å–∞ `Cz_VerticalMenuTopLinks`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Tools::safeOutput()` –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ CSRF-–∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω—ã PrestaShop (AdminModules)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã PrestaShop

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏–ø–∏–∑–∞—Ü–∏—é:**
   ```php
   $id = (int)Tools::getValue('id', 0);
   $name = pSQL(Tools::getValue('name', ''));
   ```

2. **–î–ª—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤:**
   - –ß–∏—Å–ª–∞: `(int)$variable`
   - –°—Ç—Ä–æ–∫–∏: `pSQL($variable)` –∏–ª–∏ `"'.pSQL($variable).'"`
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

3. **–î–ª—è –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - HTML: `Tools::safeOutput($variable)` –∏–ª–∏ `htmlspecialchars($variable)`
   - URL: `urlencode($variable)`

4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   ```php
   if (!$this->context->employee->hasAuthOnShop($id_shop)) {
       throw new PrestaShopException('Access denied');
   }
   ```

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:

1. **–û–±–Ω–æ–≤–∏—Ç–µ –º–æ–¥—É–ª—å –¥–æ –≤–µ—Ä—Å–∏–∏ 1.0.6**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
   ```bash
   grep "czverticalmenu" /var/www/html/var/logs/*.log
   ```

3. **–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ PrestaShop:**
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: 1.7.8.11
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Web Application Firewall (WAF)** –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- ‚úÖ SQL Injection testing
- ‚úÖ XSS vulnerability scanning
- ‚úÖ Input validation testing
- ‚úÖ CSRF protection verification
- ‚úÖ Authentication/Authorization checks

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- Manual code review
- Static analysis
- PrestaShop security guidelines compliance

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| 1.0.6 | 2025-10-24 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –≤ hookActionShopDataDuplication |
| 1.0.6 | 2025-10-24 | –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| 1.0.6 | 2025-10-24 | –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ –æ –Ω–∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ:

- **–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ** –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –ø—É–±–ª–∏—á–Ω–æ
- –°–Ω–∞—á–∞–ª–∞ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –º–æ–¥—É–ª—è
- –î–∞–π—Ç–µ –≤—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–æ–±—ã—á–Ω–æ 90 –¥–Ω–µ–π)

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-10-24
**–ê—É–¥–∏—Ç–æ—Ä:** Claude AI
**–í–µ—Ä—Å–∏—è –º–æ–¥—É–ª—è:** 1.0.6
**–°—Ç–∞—Ç—É—Å:** SECURE ‚úÖ
